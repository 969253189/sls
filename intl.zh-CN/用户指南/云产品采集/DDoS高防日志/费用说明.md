# 费用说明 {#concept_ntw_l22_j2b .concept}

DDoS高防日志功能按照日志服务的收费项进行计费，未产生日志数据则不计费。日志服务为**按量计费**模式，并为您的DDoS专属Logstore提供专属的**免费额度**。

DDoS高防日志功能提供日志的采集、存储、实时查询分析、报表等功能点，依赖于日志服务的日志数据的实时查询与分析功能。该功能的收费取决于日志服务的计费模式。日志服务计费方式为**按量计费**，并为您的DDoS专属Logstore提供专属的**免费额度**，具体费用与您的日志量有关。如果您开通了日志服务，但没有为任何网站开启日志功能，则不收费。

**说明：** 为了防止网站被恶意攻击时难以溯源、排查或报警取证，建议您[设置日志保存周期](intl.zh-CN/用户指南/云产品采集/DDoS高防日志/费用说明.md#log_lifetime)为30天以上。

## 扣费与欠费 {#section_pfc_ctw_k2b .section}

日志服务实行后收费的模式，扣费周期为天。关于扣费与欠费的详细说明请参考[扣费与欠费](../../../../../intl.zh-CN/产品定价/按量付费.md#section_l45_r5n_vdb)。

## 计费项 {#section_bbs_2df_j2b .section}

|计费项|说明|
|:--|:-|
|读写流量| -   读写流量根据传输的流量计算，传输流量为压缩后的大小。DDoS日志一般有5~10的倍压缩率。
-   读写流量也包括通流式消费接口产生读取流量，一般通过API/SDK、消费组SDK等进行操作。根据压缩后的传输流量计算，通过API/SDK可以开启压缩。

**说明：** 在日志服务的控制台中，**日志消费**下的**预览**功能也会产生微量流式消费流量。

-   对数据进行基于索引的查询、分析产生的流量免收读写流量费。例如通过控制台上进行日志查询分析、报表和告警等流量不收费。

 |
|存储空间|存储空间为压缩后原始数据量与索引数据量之和。|
|索引流量| -   索引流量根据实际索引字段进行计算。在写入时一次性收取费用。DDoS的日志默认开启全索引。
-   对同时建全文索引（FullText\)、字段索引（KeyValue），只计算一次流量。
-   索引建立后占用存储空间，所以会产生存储空间费用。

 |
|活跃Shard租用|Shard 租用只统计当前读写 Shard 的数量。已经被合并或分裂的 Shard 不收取租用费。**说明：** 日志服务默认为您创建2个Shard，并开启[自动分裂Shard](intl.zh-CN/用户指南/准备工作/操作Shard.md)功能。一般每个Shard可以支持430 GB/天的数据写入量。

|
|读写次数|日志写入日志服务的次数，由您的日志产生速度决定。后台实现机制会尽量减少读写次数。|
|外网读取流量|日志服务收集上来的日志数据被被外网程序读取消费所产生的数据流量。|

## 免费额度 {#section_qsy_jcf_j2b .section}

**在以下情况，日志服务不收费**：

-   开通了日志服务产品，但尚未为任何网站开启DDoS高防日志采集功能。
-   开启DDoS日志功能的网站日志量在免费额度之内。
-   基于索引的查询分析、报表和告警免收读写流量费。

日志服务为您的DDoS专属Logstore提供专属的免费额度，若您的数据量小于免费额度，则不收费。

|计费项|免费额度|
|:--|:---|
|读写流量| -   读取流量：正常计费
-   写入流量：免费额度 30GB/天

 |
|存储空间|3天|
|索引流量|100 GB/天|
|活跃Shard租用|4 个\*天/月|
|读写次数| -   读取次数：正常计费
-   写入次数：免费额度 1 百万次/天

 |
|外网读取流量|0|

**说明：** 您的日志数据保存时间默认设置为3天，当您修改为3天以上时，超出的部分收费。

## 计费方式 {#section_lyt_mml_l2b .section}

当开启日志分析的网站总日志量超过免费额度时，日志服务将对超出部分按照日志量收取费用。

|计费项|超出部分价格|
|:--|:-----|
|读写流量（$/GB）|0.045|
|存储空间（$/GB/天）|0.002875|
|索引流量（$/GB）|0.0875|
|活跃Shard租用（$/天）|0.01|
|读写次数（$/百万次）|0.03|
|外网读取流量（$/GB）|0.2|

## 计费样例 {#section_rbd_yjp_k2b .section}

-   **免费额度**：平均每条日志1600字节左右，每天6千万条日志，存储周期3天，则总日志量约为 96 GB/天，符合免费额度。
-   **索引**：日志量为 150 GB/天，则以 50 GB（150GB - 100GB） 计费，为 0.0875 x 50 = 17.5 美元/天。
-   **写入传输**：日志量为 300GB/天，按照6压缩比计算，实际压缩大小约为 50GB，则以 20GB（50GB - 30GB）计费，为 0.045 x 20 = 0.9 美元/天。
-   **存储空间大小**：
    -   每天 10GB 数据，压缩后为 2GB，索引流量10 GB。存储周期为 30 天，则30 天后累计 最大存储量为 30 ×（10+2）= 360GB，去掉3天免费额度后 为 27 \* （10+2）= 324 GB，一天存储最大收费为 0.002875 × 324 = 0.9315 美元。
    -   每天 1GB 数据，压缩后为 200MB，索引流量1 GB。存储周期为 30 天，则30 天后累计最大存储量为 30 ×（1000+200）≈ 36GB，去掉3天免费额度后为 27 \* （1000+200）≈ 32.4 GB，一天存储最大收费为 0.002875 × 32.4 = 0.09315 美元。
-   **活跃Shard租用**：目前有 10 个 Shard，7 个 Shard 的状态为读写，另外 3 个 Shard 已经被合并为只读，DDoS专属的Logstore总体每天只收取 3个（7个- 4个）Shard的租赁费 0.03 美元/天。
-   **写入次次数**：每天网站日志为100亿条，写入次数约为50W次（平均2000条/次），免费。
-   **外网流量**：2GB日志服务数据被投递至非阿里云产品，产生外网读取流量 0.4 美元。

## 计费FAQ {#section_tpl_shf_j2b .section}

-   **如何修改网站日志的存储时间？**

    1.  登录日志服务控制台，单击Project名称，进入Logstore列表。DDoS日志的默认Project为`ddos-pro-project-阿里云账户ID-cn-hangzhou`（大陆地区DDoS高防实例）和`ddos-pro-project-阿里云账户ID-ap-southeast-1`（其他地区DDoS高防实例）。
    2.  单击**操作**列的**修改**。
    3.  在弹出页面中修改**数据保存时间**，并单击**修改**。

        ![](images/6762_zh-CN.jpg "修改日志保存时间")

-   **如何查看当前日志量并预估费用？**

    -   在阿里云的[费用管理中心](https://expense.console.aliyun.com/)中查看每天定时刷新的费用计量数据。
    -   1.  登录DDoS高防IP控制台，单击左侧菜单中的**全量日志**。
2.  选择需要查看日志量的网站，单击右侧的**日志分析**。
3.  在查询框中输入以下查询语句，时间范围为`昨天（整点时间）`：

    ```
    __topic__: ddos_access_log | select count(1) as PV
    ```

4.  单击**查询**，选择统计图表页签，图表类型为**表格**。

    ![](images/6763_zh-CN.png "查看日志量")

        可以得到昨天一天的数据量，结合您当前配置的日志保存时间预估费用。

    -   **如何配置日志服务在产生大量日志时告警？**

        当采集到大量DDoS高防日志时，可能会超出日志服务的免费额度，产生一定的费用。如果您希望在有此类风险时收到告警通知，可以配置日志服务在产生大量日志时发送告警。

        1.  登录DDoS高防IP控制台，单击左侧菜单中的**全量日志**。
        2.  选择需要查看日志量的网站，单击右侧的**日志分析**。
        3.  在查询框中输入以下查询语句，单击**查询**：

            ```
            *| select count(1) as PV
            ```

        4.  单击查询页面右上角的**另存为快速查询**，填写快速查询的相关信息，例如`ddos-metering-pv`，单击**确定**。
        5.  单击**另存为告警**，并参考下图创建一个告警配置。规定每5分钟检查过去1小时的日志量，如果大于560万条则发送告警。

            ![](images/6764_zh-CN.png "告警规则")

            **说明：** 保证每天日志量小于100GB免费额度的情况下，推算每小时平均导入量为：100GB ÷ 1600 字节/条 ÷ 24小时 ≈ 280 万条。示例为2倍每小时日志量，即560万条的情况下报警，可以根据实际情况和需要做适当调节。


